# جلسه یازدهم جاوا اسکریپت

## مبحث Asynchronous در جاوا اسکریپت

###### شما در مبحث قبلی مفهوم callback را دریافت کردید. اما گاهی پیش می آید ما تابعی ها در یک توالی خاصی فراخوانی نکنیم. و یک ساختار نا متقارن بودن به وجود می آید. وقتی در چنین شرایطی قرار می گیریم، اصطلاحا به آن asynchronous می گوییم. با یک مثال به خوبی می شود این مفهوم را بیان کرد، به مثال زیر توجه کنید.

```bash
setInterval(clock, 1000);

function clock() {
    let dateObject = new Date();
    let hour = dateObject.getHours();
    let minute = dateObject.getMinutes();
    let second = dateObject.getSeconds();
    console.log(`${hour}:${minute}:${second}`);
}
```
###### در قطعه کد فوق، تابعی صدا شده است به اسم setInterval، این تابع دو پارامتر ورودی دریافت می کند. ورودی اول نام تابعی است که قرار بر اجرا آن می باشد و پارامتر دوم مدت زمانی است که باید این عمل تکرار شود و زمان آن بر اساس میلی ثانیه محاسبه می شود.

###### در قطعه کد فوق تابع ساعت هر یک ثانیه فراخوانی می شود و در آن ساعت و دقیقه و ثانیه در کنار یکدیگر به نمایش در می آید. این تاخیر  در زمان اجرا خود مانع اجرا پیوسته  و متوالی کد می شود و ایجاد شدن نخ زمانی های مختلف سبب اجرا نا متقارن در کد می کند.

###### برای دیدن مثال های دیگر به فایل Asynchronous.html رجوع کنید.

## مبحث Promises در جاوا اسکریپت

###### در دنیا واقعی ما آدم ها وعده می دهیم و وعده ما نسبت به انجام یک عمل دو باز خورد دارد، یک آنکه آن عمل انجام می شود و دوم آن که آن عمل انجام نمی شود، حال آنکه انجام شد، نتیجه  آن چیست و اگر انجام نشده است، دلیل آن چیست؟

###### در جاوا اسکریپت که دنیا برنامه نویسی است، گاهی رخ می دهد که می خواهیم کاری را انجام دهیم و برای ما حیاتی است که نتیجه آن چه می شود. به عبارتی اجرا یک قطعه کد متکی به انجام قطعه کد های دیگر است و این عمل زمان بر خواهد بود و این تاخیر در زمان بر روی اجرا کد ما تاثیر می گذارد یا به عبارتی باید منتظر اجرا یک تکه کد بمانیم. در این لحظه عملا ما وعده انجام یک قطعه کد را خواستار شده ایم که در جاوا اسکریپت به آن promise می گویند. با یک مثال می توان بهتر توضیح داد.

```bash
function show(value) {
    console.log(value);
}

let myPromise = new Promise(function (myResolve, myReject) {
    let x = 0;
    if (x == 0)
        myResolve("OK");
    else
        myReject("Error");
});

myPromise.then(
    function (value) {
        show(value);
    },
    function (error) {
        show(error);
    }
);
```
###### در promise دو تابع فراخوانی می شود که هر یک می توانید هر نامی داشته باشد. یکی برای حالت انجام شده یا موفقیت است و دیگری برای حالت شکست یا عدم موفقیت. 

###### دقت داشته باشید که وقتی ما یک object از نوع promise را می سازیم و آن را صدا می زنیم، باید منتظر پاسخ هایی که می دهد باشیم، این کار توسط تابعی به نام then صورت می گیرد. در then دو تابع بی نام به صورت متوالی می توان صدا نمود که اولی در صورت موفقیت است و دومی در صورت شکست، حال با شماست که در صورت شکست یا موفقیت چه واکنشی می دهید. در قطعه کد فوق برای نمونه ما صرفا دستور دادیم رشته ای که باز می گردد، چاپ شود.

###### برای دیدن مثال های دیگر می توان فایل Promises.html را مشاهده کنید.

## مبحث Async/Await در جاوا اسکریپت


###### در سر فصل قبلی در مورد promise ها صحبت کردیم، از همین رو اگر تابعی را async کنیم، همان خاصیت promise را خواهد داشت. یعنی یک حالت شکست و یک حالت موفقیت را به دنبال  خواهد داشت. لازم به ذکر است که در شرایطی خاص، زمان اجرا یک قطعه کد promise به تعویق می افتد و قطعه کدی از خروجی حاصل آن ادامه می یابد.

###### چگونه می شود در جاوا اسکریپت بر روی یک تکه کد تاخیر اعمال کرد و مانع اجرا آن شد تا زمان پاسخ promise فرا رسد، تنها راه آن استفاده از await است.

###### بگذارید با ذکر دو مثال مفهوم را شفاف تر کنیم.

```bash
function show(value) {
    console.log(value);
}

async function myFunction() {
    return "Hello";
}

myFunction().then(
    function (value) {
        show(value);
    },
    function (error) {
        show(error);
    }
);
```

###### در مثال فوق ما بجای نوشتن promise نوع تابع را به async تغییر دادیم، از همین رو احتمال  زمان بر بودن تابع محاسبه شده است و دو حالت پاسخ برای آن نیز لحاظ می شود که شما با then می توانید آن را مدیریت کنید.

###### تابع async به گونه ای طراحی شده است که در داخل خود امکان تاخیر را می پذیرد و اجازه await شدن بخشی از کد را می دهد. از همین رو به مثال دوم دقت کنید.

```bash
async function show() {
    let myPromise = new Promise(function (resolve) {
    setTimeout(function () {
        resolve("I love You !!");
    }, 3000);
    });
    console.log(await myPromise);
}

show();
```
###### در این مثال تابع show  را صدا می زنیم که خود توان اجرا then را دارد، ولی فعلا نیازی به آن نداریم. از همین رو اتفاقی که در آن می افتد حائز اهمیت است.

###### وقتی تابع صدا زده می شود، یک object promise فراخوانی می شود که در آن تابع setTimeout مانع اجرا در لحظه می شود.

###### تابع setTimeout تابعی است که در آن با ایجاد تاخیر در اجرا کد، کار خود را پیش می بریم و دو پارامتر می پذیرد که پارامتر اول تابعی است که قصد اجرا آن را داریم و پارامتر دوم مدت زمانی است که باید تاخیر اجرا صورت پذیرد که بر اساس میلی ثانیه است.

###### حال در کد بالا اجرا تابع setTimeout باعث می شود که سه ثانیه تاخیر صورت بگیرد و اجرا کد در لحظه صورت می گیرد و زمانی که log متغیر myPromise را طلب می کنیم، به دلیل await بودن آن، منتظر به پاسخ رسیدن آن می ماند که اگر نبود به شما object promise بر می گرداند.

###### حال برای دیدن و اجرا نمونه های بیشتر می توانید به فایل Async.html رجوع کنید.

### بنا به صلاحدید مدرس، می توان تمرین هفتم در کلاس یا خانه حل شود.



